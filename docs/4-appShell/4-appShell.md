 ## Lab 4: AppShell, Turbo and Caching for Performance

 1. Inspect /helloworld-webroot/page/one/index.pug and its equivalent at /page/two/index.pug. These Pug files show how parts of the html pages that both pages have in common are used in both. Both pages use or 'extend' the TEMPLATE /_part/_baseShell.pug. The template has 'blocks' named 'head', 'main', and 'footer'. The pages that use this template define how to replace these blocks. For example, /page/one/index.pug defines that the head block consists of a page-specific title tag and an included fragment /_part/_header.pug. The same fragment is also used by /page/two/index.pug.

 2. Inspect /helloworld-webroot/_part/_top.pug. This fragment represents the top menu and side drawer used on all pages. You can find it referenced in /_part/_baseShell.pug as 'include _top'. Now inspect /page/one/index.html. This is the complete HTML which Prepros has collatesd together from template and fragments. Since the server has been configured to return the 'default' page index.html when the browser requests /page/one/, this is what the end user sees. 

 3. You have seen that a pug template or fragment can 'include' another pug fragment. It can also include a fragment which is already in HTML format, such as /page/one/hello.html included in /page/one/index.html. As hello.html is the result of processing the 'markdown' file hello.md, it is a great way to integrate elements that use different technologies. 

 3. To give the application a 'Single-Page Application' feel, we use an optional JavaScript library called topseed-turbo ('TT'). When a user navigates from one URL to the next, TT replaces only the part of the HTML body that is unique to each page (The section marked '#content-wrapper' in _baseShell.pug and /_js/main.js). TT is unobtrusively loaded by JavaScript included in the _header.pug section (/setup-x.x.js). This avoids 'page flash' and makes for smoother navigation, very similar to a native 'rich client' app where only individual panels are replaced on navigation. 
 
 4. (Optional) Advanced JavaScript users may be interested to look at TS.onAppReady(UIinit) in /page/one/index.pug. TS stands for topseed-setup. TS receives an event when the #content-wrapper html is completely present in the browser (kind of like a 'pageLoaded' event), providing a 'hook' for more page-specific javascript that may require the HTML DOM to be fully initialized.

 5.  Rename /helloworld-webroot/cache.mfx to /cache.mf and inspect it. The AppCache is a good way to improve performance of a web application. The file is referred to as 'manifest' in /_part/_baseshell.pug.  If the manifest file is present, the browser will keep its listed resources in the browser cache 'forever', and serve them from there, without going to the network, until the cache.mf file itself changes. For development, we disable this by renaming it from .mf to .mfx.

6. In a later tutorial, we will discuss how in addition we may set response headers to allow caching of content at the 'edge', i.e. by the CDN, to achieve additional performance gains.
