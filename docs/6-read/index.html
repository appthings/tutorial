<!DOCTYPE html>
<html lang="en-us">
  <head>
    <base href="/tutorial/">
    <title>Read from API</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <link rel="icon" href="./favicon.ico">
    <script src="//code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdn.rawgit.com/topseed/topseed-turbo/master/vendor/loadjs.min.js"></script>
    <script src="https://cdn.rawgit.com/topseed/topseed-turbo/master/setup/setup-3.2.1.js"></script>
    <script src="./_js/main.js" async=""></script>
    <style>body {opacity: 0.1}</style>
  </head>
  <body>
    <link rel="stylesheet" href="./_sass/main.css" lazyload="1">
    <div id="appbar"> 
      <div id="appbar--brand" onclick="openDrawer()">&nbsp; ☰ &nbsp;<span class="mui--hidden-xs mui--hidden-sm">Topseed&trade; Tutorial</span></div>
      <ul id="appbar--menu">
        <li><a class="mui--hidden-xs" href="./0-agenda/">Agenda</a></li>
        <li>
          <div class="submenu"><a>Basics<span class="mui-caret"></span></a>
            <ul class="mui-dropdown__menu">
              <li><a href="./1-helloWorld/">1: Hello World</a></li>
              <li><a href="./2-theBasics/">2: The Basics</a></li>
              <li><a href="./3-goLive/">3: Golive</a></li>
              <li><a href="./4-appShell/">4: AppShell</a></li>
            </ul>
          </div>
        </li>
        <li>
          <div class="submenu"><a>Bricks and Mortar<span class="mui-caret"></span></a>
            <ul class="mui-dropdown__menu"> 
              <li><a href="./5-amp/">5: AMP and Node.js</a></li>
              <li><a href="./6-read/">6: UI Reading from API	</a></li>
              <li><a href="./7-write/">7: UI Writing to API</a></li>
              <li><a href="./8-security/">8: Login Security</a></li>
            </ul>
          </div>
        </li>
        <li>
          <div class="submenu"><a>Perspectives<span class="mui-caret"></span></a>
            <ul class="mui-dropdown__menu mui-dropdown__menu--right">
              <li><a href="./9-comps/">9: Web Components</a></li>
              <li><a href="./10-mobile/">10: Mobile App		</a></li>
            </ul>
          </div>
        </li>
      </ul>
    </div>
    <div id="sidedrawer" onclick="closeDrawer()">
      <div id="sidedrawer--brand">&nbsp; ☰ Topseed&trade; Tutorials</div>
      <div class="mui-divider"></div>
      <ul id="sidedrawer--menu">
        <li><a href="./0-agenda/">Agenda</a></li>
      </ul>
      <ul id="sidedrawer--menu">
        <li><a href="./1-helloWorld/">1: Hello World</a></li>
        <li><a href="./2-theBasics/">2: The Basics</a></li>
        <li><a href="./3-goLive/">3: Golive</a></li>
        <li><a href="./4-appShell/">4: AppShell</a></li>
      </ul>
      <ul id="sidedrawer--menu">
        <li><a href="./5-amp/">5: AMP and Node.js</a></li>
        <li><a href="./6-read/">6: UI Reading from API	</a></li>
        <li><a href="./7-write/">7: UI Writing to API</a></li>
        <li><a href="./8-security/">8: Login Security</a></li>
      </ul>
      <ul id="sidedrawer--menu">
        <li><a href="./9-comps/">9: Web Components</a></li>
        <li><a href="./10-mobile/">10: Mobile App						</a></li>
      </ul>
    </div>
    <script>
      function openDrawer() {
      	$('#sidedrawer').css('transform', 'translateX(201px)')
      }
      function closeDrawer() {
      	$('#sidedrawer').css('transform', 'translateX(0px)')
      }
      $('.submenu').hover(function() {
      		toggleSub(this.firstChild, true)
      	},
      	function() {
      		toggleSub(this.firstChild, false)
      });
      
      $('.submenu > a').click(function() {
      		toggleSub(this, true)
      });
      
      $('.submenu > ul').click(function() {
      		toggleSub(this.previousElementSibling, false)
      });
      
      function toggleSub(toggleEl, show) {
      	var wrapperEl = toggleEl.parentNode,
      	menuEl = toggleEl.nextElementSibling
      	
      	function closeDropdownFn() { 
      		menuEl.classList.remove('mui--is-open') 
      	}
      
      	function openDropdownFn(){
      		var wrapperRect = wrapperEl.getBoundingClientRect(),
      		toggleRect = toggleEl.getBoundingClientRect()
      		var top = toggleRect.top - wrapperRect.top + toggleRect.height
      		var left =  toggleRect.left + toggleRect.width - menuEl.width
      		menuEl.style.top = top + 'px'
      		if (menuEl.classList.contains('mui-dropdown__menu--right'))
      			menuEl.style.left = left + 'px'
      		else
      			menuEl.style.left = wrapperRect.left + 'px'
      		
      		menuEl.classList.add('mui--is-open')
      	}
      	show ? openDropdownFn() : closeDropdownFn()
      }
      
      			
    </script>
    <div id="content-wrapper">
      <div class="mui-container-fluid"><h2 id="lab-6-ui-reading-from-an-api">Lab 6: UI Reading from an API</h2>
<ol>
<li><p>For this and the next lab, we work on an &#39;Admin&#39; module that allows listing (and adding to) a &#39;Link Blog&#39;, or list of links. In a browser, go to <a href='http://localhost:8091' target='_blank'>http://localhost:8091</a> and click on the &#39;Admin&#39; menu item to navigate to the &#39;Topseed Admin Console&#39; (We will add login security in another lab). The Admin module has its own appshell and menu (see /_part/admin/). To signal a full screen refresh to turbo, we added a &#39;#&#39; to the link that leads to the Admin home screen at <a href='http://localhost:8091/admin/home/#' target='_blank'>http://localhost:8091/admin/home/#</a>. The refresh ensures that the standard menu (which would otherwise remain &#39;cached&#39; and re-displayed) is replaced by the Admin menu. </p>
</li>
<li><p>Click on the &#39;Linkblog&#39; menu item at <a href='http://localhost:8091/admin/linkblog/' target='_blank'>http://localhost:8091/admin/linkblog/</a>to navigate to a list of Linkblog items. Rather than composing a screen in full on a server, modern web apps often take a HTML page to the browser first and then let the browser call an API to &#39;fill in&#39; the data, using JavaScript. This way, the static elements of a page can be served by a fast CDN, and the dynamic/data parts can be obtained directly from the data source.</p>
</li>
<li><p>The Linkblog list is populated with data coming from a JSON response to an API call. By default, the Lab project is configured to obtain the API response from a file at /topseed-webroot/linkblog/dummy.json or <a href='http://localhost:8091/linkblog/dummy.json' target='_blank'>http://localhost:8091/linkblog/dummy.json</a>. However, in the next lab we will call a real, live database API that resides on a separate API server. </p>
</li>
<li><p>Now click the &#39;Add Item&#39; button and note how the browser URL changed to <a href='http://localhost:8091/admin/linkblog/detail.html' target='_blank'>http://localhost:8091/admin/linkblog/detail.html</a>. This is a &#39;stable URL&#39; for the the data entry form to add/write a new item. &#39;Stable URL&#39; means that page is not lost when you hit the browser refresh button, and that the page is &#39;bookmarkable&#39;, which is almost always a good thing. For now, click &#39;Cancel&#39; to return to the list at <a href='http://localhost:8091/admin/linkblog/' target='_blank'>http://localhost:8091/admin/linkblog/</a>.</p>
</li>
<li><p>Inspect /topseed-webroot/admin/linkblog/index.pug. This file defines the composition of the Linkblog list screen. In the &#39;HTML&#39; part of this file, the list is represented by the pug statement &#39;table#grid&#39; (&lt;table id=&quot;grid&quot;&gt;). The &#39;script.&#39; part of the file is responsible for causing the grid data to be loaded and rendered. The dot at the end of &#39;script.&#39; tells Pug to not convert what follows to HTML. </p>
</li>
<li><p>In &#39;script.&#39; we load external JavaScript that encapsulates logic, which keeps the page HTML clean and designer-friendly. In this example TS.loadOnAppReady loads /admin/linkblog/LinkblogBusiness.js, then calls the UIinit function in the page. This function triggers the &#39;list&#39; function of LinkblogBusiness, which asynchronously loads data from the API, and - once the data has been received - renders the grid as well as the data in the grid. Depending on how much data is to be loaded, a more advanced version of LinkblogBusiness could have a separate function (e.g. init()) to first render the grid without data, and the list() function would only load and render the list items.</p>
</li>
<li><p>Open /topseed-webroot/admin/linkblog/LinkblogBusiness.js and scroll to the end of the file. See how LinkblogBusiness wraps a &#39;SimpleBusiness&#39; object instance named &#39;sb&#39; that is returned to the page after we added a LinkblogDao &#39;Data Access Object&#39; instance. The page-specific custom functionality of SimpleBusiness is added close to the top of the file, beginning with &#39;var SimpleBusiness = BLX.extend({&#39;. We keep common business functionality in a base &#39;class&#39; named BLX.js (&#39;BusinessLogiX&#39;), and common data service functionality in BDS.js (BaseDataService). (Both are loaded by /_js/admin.js, the &#39;admin module version&#39; of main.js.) </p>
</li>
<li><p>In LinkblogBusiness.js we use &#39;var SimpleBusiness = BLX.extend({&#39; instead of the more recent &#39;class SimpleBusiness extends BLX {&#39;, because Internet Explorer does not support &#39;class&#39;. However, Microsoft&#39;s &#39;Edge&#39; browser supports it. We will use &#39;class&#39; once IE has lost its remaining popularity; see /admin/linkblog/LinkblogBusiness2.js for an example. Note the resulting improvement in function signatures e.g. &#39;list()&#39; vs &#39;,list: function()&#39;. If you can exclude the use of IE (such as for an internal webapp or a mobile app) we recommend you use the &#39;class&#39; version. You can read more about the IE-compatible version at <a href='http://johnresig.com/blog/simple-javascript-inheritance' target='_blank'>http://johnresig.com/blog/simple-javascript-inheritance</a>. To use the &#39;class&#39; version, in this example you would use TS.loadOnAppReady(&#39;/admin/linkblog/LinkblogBusiness2.js&#39; in /admin/linkblog/index.pug and /detail.pug and change /_js/admin.js to load BLX2.js and BDS2.js instead of BLX.js and BDS.js.</p>
</li>
<li><p>In LinkblogBusiness.js, inspect the code section following &#39;, list: function(listId)&#39;. The JavaScript in /admin/linkblog/index.pug triggers this function with &#39;sb.list(&#39;#grid&#39;)&#39;. Brushing over the details of obtaining the data for now, this function receives a &#39;_listPromise&#39; of data from the configured API. When data is returned, the function _renderList enters &#39;_listPromise.then(function(values){&#39;, builds the grid with the received values (a JSON array of rows) and renders it in the page element with id &#39;grid&#39;. There are many ways to render lists. In this example we use <a href='https://dataTables.net/' target='_blank'>https://dataTables.net/</a> to deliver advanced grid sorting, searching and paging features. </p>
</li>
<li><p>JavaScript Promises are a modern way to manage process flow. They are especially useful for handling asynchronous calls such as http requests to an API that may require error handling, such as connection errors. They replace classic asynchronous callbacks that are prone to &#39;Callback Hell&#39;; see <a href='http://callbackhell.com/' target='_blank'>http://callbackhell.com/</a>.  A lot of public APIs, such as Google Firebase, use or allow the use of Promises, and you can &#39;promisify&#39; those that don&#39;t. Promises are important, learn how they work at <a href='http://www.telerik.com/blogs/what-is-the-point-of-promises' target='_blank'>http://www.telerik.com/blogs/what-is-the-point-of-promises</a>. The post <a href='https://stackoverflow.com/questions/22539815/arent-promises-just-callbacks' target='_blank'>https://stackoverflow.com/questions/22539815/arent-promises-just-callbacks</a> may also help.</p>
</li>
<li><p>The LinkblogDao Data Access Object is responsible for obtaining the raw list data. See &#39;urlSpec&#39; at the top of LinkblogBusiness.js and how LinkblogDao extends BDS (which contains common data access functionality). Also see at the bottom of LinkblogBusiness.js how urlSpec is passed to LinkblogDao with &#39;sb.linkblogDao = new LinkblogDao(urlSpec)&#39;. In this case, unlike SimpleBusiness, LinkblogDao has no added functionality, so we could write &#39;sb.linkblogDao = new BDS(urlSpec)&#39; instead.</p>
</li>
<li><p>Inspect /_js/BDS.js and its &#39;selectList&#39; function. It calls a shared static _get function which uses fetch_ to call the urlSpec URL and returns a promise of the response content. &#39;Fetch&#39; is a modern replacement for Ajax/XMLHttpRequest. Fetch uses Promises! Read more about Fetch at <a href='https://davidwalsh.name/fetch' target='_blank'>https://davidwalsh.name/fetch</a>. At the end of the next Lab we learn how an API server can handle this fetch request. In this Lab, the content of /topseed-webroot/linkblog/dummy.json or <a href='http://localhost:8091/linkblog/dummy.json' target='_blank'>http://localhost:8091/linkblog/dummy.json</a> is returned.</p>
</li>
</ol>

        <div class="mui--text-left"><a class="mui-btn mui-btn--raised" href="./7-write/">Next Tutorial  </a><a class="mui-btn" href="./0-agenda/">Return to Agenda</a></div>
      </div>
      <script>
        TS.onAppReady(UIinit)
        function UIinit() {
        	console.log('6-read')
        }
        
      </script>
    </div>
    <div id="footer">
      <div id="footer_div"><a href="https://gitter.im/topseed/Lobby" target="_blank">Forum </a>
        <div id="footer_div--right"><a href="https://github.com/topseed/topseed" target="_blank">Kitchen Sink</a></div>
      </div>
    </div>
  </body>
</html>