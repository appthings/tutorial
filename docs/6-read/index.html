<!DOCTYPE html>
<html lang="en-us">
  <head>
    <base href="/tutorial/">
    <title>Read from API</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="-1">
    <link rel="icon" href="./favicon.ico">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono">
    <script>var main_js = '/tutorial/_js/main.js'</script>
    <script src="//code.jquery.com/jquery-3.2.1.slim.min.js" async> </script>
    <script src="//rawgit.com/topseed/topseed-turbo/master/setup/setup-6.3.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-89411776-5', 'auto');
      ga('send', 'pageview');
    </script>
    <style>body {opacity: 0.1} </style>
  </head>
  <body>
    <link rel="stylesheet" href="./_sass/main.css">
    <div id="appbar"> 
      <div id="appbar--brand" onclick="openDrawer()">&nbsp;&nbsp; ☰<span class="mui--hidden-xs mui-hidden-sm">&nbsp;&nbsp;Topseed&trade; Tutorial</span></div>
      <ul id="appbar--menu">
        <li><a class="mui--hidden-xs" href="./0-agenda/">Agenda</a></li>
        <li>
          <div class="submenu"><a>Basics<span class="mui-caret"></span></a>
            <ul class="mui-dropdown__menu">
              <li><a href="./1-helloWorld/">1: Hello World</a></li>
              <li><a href="./2-theBasics/">2: The Basics</a></li>
              <li><a href="./3-goLive/">3: Golive</a></li>
              <li><a href="./4-appShell/">4: AppShell</a></li>
            </ul>
          </div>
        </li>
        <li>
          <div class="submenu"><a>Bricks+Mortar<span class="mui-caret"></span></a>
            <ul class="mui-dropdown__menu"> 
              <li><a href="./5-amp/">5: AMP and Node.js</a></li>
              <li><a href="./6-read/">6: UI Reading from API	</a></li>
              <li><a href="./7-write/">7: UI Writing to API</a></li>
              <li><a href="./8-security/">8: Login Security</a></li>
            </ul>
          </div>
        </li>
        <li>
          <div class="submenu"><a>Perspectives<span class="mui-caret"></span></a>
            <ul class="mui-dropdown__menu mui-dropdown__menu--right">
              <li><a href="./9-comps/">9: Web Components</a></li>
              <li><a href="./10-mobile/">10: Mobile App</a></li>
            </ul>
          </div>
        </li>
        <li class="mui--hidden-xs mui--hidden-sm">&nbsp;</li>
      </ul>
    </div>
    <div id="sidedrawer" onclick="closeDrawer()">
      <div id="sidedrawer--brand">&nbsp; ☰ Topseed&trade; Tutorials</div>
      <div class="mui-divider"></div>
      <ul id="sidedrawer--menu">
        <li><a href="./0-agenda/">Agenda</a></li>
      </ul>
      <ul id="sidedrawer--menu">
        <li><a href="./1-helloWorld/">1: Hello World</a></li>
        <li><a href="./2-theBasics/">2: The Basics</a></li>
        <li><a href="./3-goLive/">3: Golive</a></li>
        <li><a href="./4-appShell/">4: AppShell</a></li>
      </ul>
      <ul id="sidedrawer--menu">
        <li><a href="./5-amp/">5: AMP and Node.js</a></li>
        <li><a href="./6-read/">6: UI Reading from API	</a></li>
        <li><a href="./7-write/">7: UI Writing to API</a></li>
        <li><a href="./8-security/">8: Login Security</a></li>
      </ul>
      <ul id="sidedrawer--menu">
        <li><a href="./9-comps/">9: Web Components</a></li>
        <li><a href="./10-mobile/">10: Mobile App						</a></li>
      </ul>
    </div>
    <script>
      function openDrawer() {
      	$('#sidedrawer').css('transform', 'translateX(201px)')
      }
      function closeDrawer() {
      	$('#sidedrawer').css('transform', 'translateX(0px)')
      }
    </script>
    <div id="content-wrapper">
      <div id="page6">
        <div class="mui-container-fluid"><h2 id="lab-6-ui-reading-from-an-api">Lab 6: UI Reading from an API</h2>
<ol>
<li><p>For this and the <a href="./7-write/">next lab</a>, we work on an &#39;Admin&#39; module that allows listing (and adding to) a &#39;Linkblog&#39;, or list of links. In a browser, go to <a href='http://localhost:8091' target='_blank'>http://localhost:8091</a> and click on the &#39;Admin&#39; menu item to navigate to the &#39;Topseed Admin Console&#39; (We will add login security in tutorial 8). The Admin module has its own appshell and menu (see <code>/_part/admin/</code>). To signal a full screen refresh to turbo, we added a <code>&#39;#&#39;</code> to the link that leads to the Admin home screen at <a href='http://localhost:8091/admin/home/#' target='_blank'>http://localhost:8091/admin/home/#</a>. The refresh ensures that the standard menu (which would otherwise remain &#39;cached&#39; and re-displayed) is replaced by the Admin menu. </p>
</li>
<li><p>Click on the &#39;Linkblog&#39; menu item at <a href='http://localhost:8091/admin/linkblog/' target='_blank'>http://localhost:8091/admin/linkblog/</a>to navigate to a list of linkblog items. Rather than composing a screen in full on a server, modern web apps often take a HTML page to the browser first and then let the browser call an API to &#39;fill in&#39; the data, using JavaScript. This way, the static elements of a page can be served by a fast CDN, and the dynamic/data parts can be obtained directly from the data source.</p>
</li>
<li><p>The linkblog list is populated with data coming from a <em>JSON</em> response to an API call. By default, the tutorial project is configured to obtain the API response from a file at <code>/topseed-webroot/linkblog/dummy.json</code> or <a href='http://localhost:8091/linkblog/dummy.json' target='_blank'>http://localhost:8091/linkblog/dummy.json</a>. However, in the next tutorial we will call a real, live database API that resides on a separate API server. </p>
</li>
<li><p>Now click the &#39;Add Item&#39; button and note how the browser URL changed to <a href='http://localhost:8091/admin/linkblog/detail.html' target='_blank'>http://localhost:8091/admin/linkblog/detail.html</a>. This is a <em>stable URL</em> for the the data entry form to add/write a new item. &#39;Stable URL&#39; means that page is not lost when you hit the browser refresh button, and that the page is &#39;bookmarkable&#39;, which is almost always a good thing. For now, click &#39;Cancel&#39; to return to the list at <a href='http://localhost:8091/admin/linkblog/' target='_blank'>http://localhost:8091/admin/linkblog/</a>.</p>
</li>
<li><p>Inspect <code>/topseed-webroot/admin/linkblog/index.pug</code>. This file defines the composition of the linkblog list screen. In the &#39;HTML&#39; part of this file, the list is represented by the pug statement <code>&#39;table#grid&#39;</code> (<code>&#39;&lt;table id=&quot;grid&quot;&gt;&#39;</code>). The <code>&#39;script.&#39;</code> part of the file is responsible for causing the grid data to be loaded and rendered. The dot at the end of <code>&#39;script.&#39;</code> tells Pug to not convert what follows to HTML. </p>
</li>
<li><p>In <code>&#39;script.&#39;</code> we load external JavaScript that encapsulates logic, which keeps the page HTML clean and designer-friendly. In this example <code>&#39;TS.loadOnAppReady&#39;</code> loads <code>/admin/linkblog/LinkblogBusiness.js</code>, then calls the <code>&#39;UIinit&#39;</code> function in the page. This function triggers the <code>&#39;list&#39;</code> function of <code>LinkblogBusiness</code>, which asynchronously loads data from the API, and &mdash; once the data has been received &mdash; renders the grid as well as the data in the grid. Depending on how much data is to be loaded, a more advanced version of <code>LinkblogBusiness</code> could have a separate function (e.g. <code>&#39;init()&#39;</code>) to first render the grid without data, and the <code>&#39;list()&#39;</code> function would only load and render the list items.</p>
</li>
<li><p>Open <code>/topseed-webroot/admin/linkblog/LinkblogBusiness.js</code> and scroll to the end of the file. See how <code>LinkblogBusiness</code> wraps a <code>&#39;SimpleBusiness&#39;</code> object instance named <code>&#39;sb&#39;</code> that is returned to the page after we added a <code>LinkblogDao</code> <em>Data Access Object (DAO)</em> instance. The page-specific custom functionality of <code>SimpleBusiness</code> is added close to the top of the file, beginning with <code>&#39;var SimpleBusiness = BLX.extend({&#39;</code>. We keep common business functionality in a base <code>&#39;class&#39;</code> named <code>BLX.js</code> (&#39;BusinessLogiX&#39;), and common data service functionality in <code>BDS.js</code> (BaseDataService). Both are loaded by <code>/_js/admin.js</code>, the &#39;admin module version&#39; of <code>main.js</code>.</p>
</li>
<li><p>In <code>LinkblogBusiness.js</code> we use <code>&#39;var SimpleBusiness = BLX.extend({&#39;</code> instead of the more recent <code>&#39;class SimpleBusiness extends BLX {&#39;</code>, because Internet Explorer (IE) does not support &#39;class&#39;. However, Microsoft&#39;s &#39;Edge&#39; browser supports it. We will use &#39;class&#39; once IE has lost its remaining popularity; see <code>/admin/linkblog/LinkblogBusiness2.js</code> for an example. Note the resulting improvement in function signatures e.g. <code>&#39;list()&#39;</code> vs <code>&#39;,list: function()&#39;</code>. If you can exclude the use of IE (such as for an internal web-app or a mobile app) we recommend you use the &#39;class&#39; version. You can read more about the IE-compatible version at <a href='http://johnresig.com/blog/simple-javascript-inheritance' target='_blank'>http://johnresig.com/blog/simple-javascript-inheritance</a>. To use the &#39;class&#39; version, in this example you would use <code>TS.loadOnAppReady(&#39;/admin/linkblog/LinkblogBusiness2.js&#39;</code> in <code>/admin/linkblog/index.pug</code> and <code>/detail.pug</code> and change <code>/_js/admin.js</code> to load <code>BLX2.js</code> and <code>BDS2.js</code> instead of <code>BLX.js</code> and <code>BDS.js</code>.</p>
</li>
<li><p>In LinkblogBusiness.js, inspect the code section following <code>&#39;, list: function(listId)&#39;</code>. The JavaScript in <code>/admin/linkblog/index.pug</code> triggers this function with <code>&#39;sb.list(&#39;#grid&#39;)&#39;</code>. Brushing over the details of obtaining the data for now, this function receives a <code>&#39;_listPromise&#39;</code> of data from the configured API. When data is returned, the function <code>&#39;_renderList&#39;</code> enters <code>&#39;_listPromise.then(function(values){&#39;</code>, builds the grid with the received values (a JSON array of rows) and renders it in the page element with <code>id &#39;grid&#39;</code>. There are many ways to render lists. In this example we use <a href='https://dataTables.net/' target='_blank'>https://dataTables.net/</a> to deliver advanced grid sorting, searching and paging features. </p>
</li>
<li><p>JavaScript <em>promises</em> are a modern way to manage process flow. They are especially useful for handling asynchronous calls such as HTTP requests to an API that may require error handling, such as connection errors. They replace classic asynchronous callbacks that are prone to <em>&#39;Callback Hell&#39;</em>; see <a href='http://callbackhell.com' target='_blank'>http://callbackhell.com</a>.  A lot of public APIs, such as Google Firebase, use or allow the use of promises, and you can &#39;promisify&#39; those that don&#39;t. Promises are important, learn how they work at <a href='http://www.telerik.com/blogs/what-is-the-point-of-promises' target='_blank'>http://www.telerik.com/blogs/what-is-the-point-of-promises</a>. The post <a href='https://stackoverflow.com/questions/22539815/arent-promises-just-callbacks' target='_blank'>https://stackoverflow.com/questions/22539815/arent-promises-just-callbacks</a> may also help.</p>
</li>
<li><p>The <code>LinkblogDao</code> Data Access Object is responsible for obtaining the raw list data. See <code>&#39;urlSpec&#39;</code> at the top of <code>LinkblogBusiness.js</code> and how <code>LinkblogDao</code> extends <code>BDS</code> (which contains common data access functionality). Also see at the bottom of <code>LinkblogBusiness.js</code> how <code>urlSpec</code> is passed to <code>LinkblogDao</code> with <code>&#39;sb.linkblogDao = new LinkblogDao(urlSpec)&#39;</code>. Unlike <code>SimpleBusiness</code>, in this case <code>LinkblogDao</code> has no added functionality, so we could write <code>&#39;sb.linkblogDao = new BDS(urlSpec)&#39;</code> instead.</p>
</li>
<li><p>Inspect <code>&#39;/_js/BDS.js</code> and its <code>&#39;selectList&#39;</code> function. It calls a shared static <code>&#39;_get&#39;</code> function which uses <code>&#39;fetch_&#39;</code> to call the <code>urlSpec</code> URL and returns a promise of the response content. <em>Fetch</em> is a modern replacement for Ajax/XMLHttpRequest. Fetch uses promises! Read more about Fetch at <a href='https://davidwalsh.name/fetch' target='_blank'>https://davidwalsh.name/fetch</a>. At the end of the next lab we learn how an API server can handle this fetch request. In this lab, the content of <code>/topseed-webroot/linkblog/dummy.json</code> or <a href='http://localhost:8091/linkblog/dummy.json' target='_blank'>http://localhost:8091/linkblog/dummy.json</a> is returned.</p>
</li>
</ol>

          <div class="mui--text-left"><a class="mui-btn mui-btn--raised" href="./7-write/">
               Next <span class="mui--hidden-xs">Tutorial</span></a><a class="mui-btn" href="./5-amp/">Previous <span class="mui--hidden-xs">Tutorial</span></a><a class="mui-btn" href="./0-agenda/"><span class="mui--hidden-xs mui--hidden-sm">Return to&nbsp;</span><span>Agenda </span></a></div>
        </div>
      </div>
      <script>
        TS.onAppReady(UIinit)
        function UIinit() {
        	initSubmenu()
        }
        
      </script>
    </div>
  </body>
</html>